<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>控制面板測試</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .animate-fade-in-scale {
      animation: fadeInScale 0.3s ease-out;
    }
    @keyframes fadeInScale {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
  </style>
</head>
<body class="bg-gray-100 p-8">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo, useCallback, useRef } = React;
    
    // 模擬進度狀態
    const mockProgressState = {
      currentStage: 1,
      overallProgress: 45,
      stageProgress: 60,
      status: 'running',
      stages: {
        serp: { status: 'completed', progress: 100 },
        crawler: { status: 'running', progress: 60 },
        ai: { status: 'pending', progress: 0 }
      },
      timing: {
        startTime: new Date(Date.now() - 300000),
        currentStageStartTime: new Date(Date.now() - 120000),
        estimatedTotalTime: 600,
        estimatedRemainingTime: 300
      },
      jobId: 'test-job-123',
      canCancel: true
    };

    // 簡化版的控制面板組件
    function TestControlPanel({ progressState, onFeedback }) {
      const [status, setStatus] = useState(progressState.status);
      const [showConfirm, setShowConfirm] = useState(null);
      const [isProcessing, setIsProcessing] = useState(false);

      const handleAction = async (action) => {
        setIsProcessing(true);
        
        // 模擬操作延遲
        setTimeout(() => {
          switch (action) {
            case 'start':
              setStatus('starting');
              setTimeout(() => setStatus('running'), 1000);
              onFeedback?.({ type: 'success', message: '分析已開始' });
              break;
            case 'pause':
              setStatus('paused');
              onFeedback?.({ type: 'info', message: '分析已暫停' });
              break;
            case 'resume':
              setStatus('running');
              onFeedback?.({ type: 'success', message: '分析已恢復' });
              break;
            case 'cancel':
              setStatus('cancelled');
              onFeedback?.({ type: 'info', message: '分析已取消' });
              break;
            case 'retry':
              setStatus('starting');
              setTimeout(() => setStatus('running'), 1000);
              onFeedback?.({ type: 'success', message: '重新開始分析' });
              break;
          }
          setIsProcessing(false);
          setShowConfirm(null);
        }, 500);
      };

      const canStart = status === 'idle';
      const canPause = status === 'running';
      const canResume = status === 'paused';
      const canCancel = ['running', 'paused', 'starting'].includes(status);
      const canRetry = status === 'error';

      return (
        <div className="bg-white rounded-lg border border-gray-200 p-6 space-y-6">
          {/* 狀態指示器 */}
          <div className="text-center">
            <div className={`inline-flex items-center space-x-2 px-3 py-1 rounded-full text-sm font-medium ${
              status === 'running' ? 'bg-green-100 text-green-800' :
              status === 'paused' ? 'bg-yellow-100 text-yellow-800' :
              status === 'completed' ? 'bg-blue-100 text-blue-800' :
              status === 'error' ? 'bg-red-100 text-red-800' :
              status === 'cancelled' ? 'bg-gray-100 text-gray-800' :
              'bg-gray-100 text-gray-600'
            }`}>
              <div className={`w-2 h-2 rounded-full ${
                status === 'running' ? 'bg-green-400 animate-pulse' :
                status === 'paused' ? 'bg-yellow-400 animate-pulse' :
                status === 'completed' ? 'bg-blue-400' :
                status === 'error' ? 'bg-red-400' :
                status === 'cancelled' ? 'bg-gray-400' :
                'bg-gray-300'
              }`}></div>
              <span>
                {status === 'running' ? '進行中' :
                 status === 'starting' ? '啟動中' :
                 status === 'paused' ? '已暫停' :
                 status === 'completed' ? '已完成' :
                 status === 'error' ? '發生錯誤' :
                 status === 'cancelled' ? '已取消' :
                 '待機中'}
              </span>
            </div>
          </div>

          {/* 控制按鈕 */}
          <div className="flex justify-center space-x-3">
            {/* 開始按鈕 */}
            {canStart && (
              <button
                onClick={() => handleAction('start')}
                disabled={isProcessing}
                className="inline-flex items-center space-x-2 px-4 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700 rounded-lg border border-green-600 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 hover:scale-105 active:scale-95 disabled:opacity-50"
              >
                <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M8 5v14l11-7z" />
                </svg>
                <span>開始分析</span>
              </button>
            )}

            {/* 暫停按鈕 */}
            {canPause && (
              <button
                onClick={() => setShowConfirm('pause')}
                disabled={isProcessing}
                className="inline-flex items-center space-x-2 px-4 py-2 text-sm font-medium text-yellow-600 bg-white hover:bg-yellow-50 rounded-lg border border-yellow-300 hover:border-yellow-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2 hover:scale-105 active:scale-95 disabled:opacity-50"
              >
                <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z" />
                </svg>
                <span>暫停分析</span>
              </button>
            )}

            {/* 恢復按鈕 */}
            {canResume && (
              <button
                onClick={() => handleAction('resume')}
                disabled={isProcessing}
                className="inline-flex items-center space-x-2 px-4 py-2 text-sm font-medium text-green-600 bg-white hover:bg-green-50 rounded-lg border border-green-300 hover:border-green-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 hover:scale-105 active:scale-95 disabled:opacity-50"
              >
                <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M8 5v14l11-7z" />
                </svg>
                <span>恢復分析</span>
              </button>
            )}

            {/* 取消按鈕 */}
            {canCancel && (
              <button
                onClick={() => setShowConfirm('cancel')}
                disabled={isProcessing}
                className="inline-flex items-center space-x-2 px-4 py-2 text-sm font-medium text-red-600 bg-white hover:bg-red-50 rounded-lg border border-red-300 hover:border-red-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 hover:scale-105 active:scale-95 disabled:opacity-50"
              >
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
                <span>取消分析</span>
              </button>
            )}

            {/* 重試按鈕 */}
            {canRetry && (
              <button
                onClick={() => handleAction('retry')}
                disabled={isProcessing}
                className="inline-flex items-center space-x-2 px-4 py-2 text-sm font-medium text-blue-600 bg-white hover:bg-blue-50 rounded-lg border border-blue-300 hover:border-blue-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 hover:scale-105 active:scale-95 disabled:opacity-50"
              >
                <svg className="w-4 h-4 transition-transform duration-300 hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
                <span>重試</span>
              </button>
            )}

            {/* 測試錯誤狀態按鈕 */}
            <button
              onClick={() => setStatus('error')}
              className="inline-flex items-center space-x-2 px-3 py-2 text-xs font-medium text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg border border-gray-300 transition-all duration-200"
            >
              測試錯誤
            </button>
          </div>

          {/* 確認對話框 */}
          {showConfirm && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 animate-fade-in-scale">
              <div className="bg-white rounded-lg shadow-xl max-w-md mx-4 p-6">
                <div className="flex items-center mb-4">
                  <div className="flex-shrink-0 w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center">
                    <svg className="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z" />
                    </svg>
                  </div>
                  <h3 className="ml-4 text-lg font-semibold text-gray-900">
                    確認{showConfirm === 'pause' ? '暫停' : '取消'}
                  </h3>
                </div>
                <p className="text-gray-700 mb-6">
                  {showConfirm === 'pause' 
                    ? '分析將暫停，您可以隨時恢復。已收集的數據會保留。'
                    : '確定要取消當前的 SEO 分析嗎？已收集的數據將會保留。'}
                </p>
                <div className="flex space-x-3 justify-end">
                  <button
                    onClick={() => setShowConfirm(null)}
                    className="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-lg hover:bg-gray-200 transition-all duration-200"
                  >
                    取消
                  </button>
                  <button
                    onClick={() => handleAction(showConfirm)}
                    className={`px-4 py-2 text-sm font-medium text-white rounded-lg transition-all duration-200 ${
                      showConfirm === 'pause' 
                        ? 'bg-yellow-600 hover:bg-yellow-700' 
                        : 'bg-red-600 hover:bg-red-700'
                    }`}
                  >
                    確定{showConfirm === 'pause' ? '暫停' : '取消'}
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    // Toast 通知組件
    function Toast({ messages }) {
      return (
        <div className="fixed top-4 right-4 z-50 space-y-2">
          {messages.map(msg => (
            <div key={msg.id} className={`px-4 py-2 rounded-lg shadow-lg text-sm font-medium animate-fade-in-scale ${
              msg.type === 'success' ? 'bg-green-600 text-white' :
              msg.type === 'error' ? 'bg-red-600 text-white' :
              msg.type === 'info' ? 'bg-blue-600 text-white' :
              'bg-gray-600 text-white'
            }`}>
              {msg.message}
            </div>
          ))}
        </div>
      );
    }

    // 主測試應用
    function TestApp() {
      const [toasts, setToasts] = useState([]);

      const handleFeedback = useCallback((feedback) => {
        const id = Date.now();
        setToasts(prev => [...prev, { ...feedback, id }]);
        
        setTimeout(() => {
          setToasts(prev => prev.filter(toast => toast.id !== id));
        }, feedback.duration || 3000);
      }, []);

      return (
        <div className="max-w-2xl mx-auto">
          <div className="mb-6">
            <h1 className="text-2xl font-bold text-gray-900 mb-2">控制面板功能測試</h1>
            <p className="text-gray-600">
              測試 Phase 3.2 Step 3 - 控制按鈕互動優化功能
            </p>
          </div>
          
          <TestControlPanel 
            progressState={mockProgressState} 
            onFeedback={handleFeedback}
          />

          <div className="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
            <h3 className="font-medium text-blue-800 mb-2">測試項目：</h3>
            <ul className="text-sm text-blue-700 space-y-1">
              <li>✓ 按鈕狀態切換</li>
              <li>✓ 確認對話框顯示</li>
              <li>✓ 觸控優化動畫效果</li>
              <li>✓ Toast 通知回饋</li>
              <li>✓ 狀態指示器動畫</li>
              <li>✓ 長按手勢支援</li>
            </ul>
          </div>

          <div className="mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
            <h3 className="font-medium text-green-800 mb-2">長按功能說明：</h3>
            <ul className="text-sm text-green-700 space-y-1">
              <li>• <strong>開始按鈕</strong>：長按 0.8 秒快速啟動（跳過確認）</li>
              <li>• <strong>取消按鈕</strong>：長按 1.0 秒強制取消（跳過確認）</li>
              <li>• 長按時會有視覺回饋和觸控振動</li>
              <li>• 僅在觸控優化模式下啟用</li>
            </ul>
          </div>

          <Toast messages={toasts} />
        </div>
      );
    }

    // 渲染應用
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<TestApp />);
  </script>
</body>
</html>